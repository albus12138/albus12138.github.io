---
layout:     post
title:      XMan Day0x01
category: coding
description: Crypto - 庄泽浩
---
## 0x00 密码学概论
密码学概念：
- 密码学是一门研究信息加密解密的技术。通常，两个通信的人叫Alice 和 Bob 第三方叫Oscar。 Alice发送给bob的称为明文，通过商量好的密钥加密后将密文发送给bob。

密码体制：
- 密码体制是满足下述条件的五元组PCKεD，P、C、K是有限集，分布表示明文、密文、密钥，ε和D分别是加密和解密法则，任意密钥K和明文x都有d<sub>k</sub>(e<sub>k</sub>(x)) = x。集合P、C、K通常也称为明文空间、密文空间、和密钥空间。密钥空间的大小称为该密码体制的密钥量。他是衡量密码安全性的重要条件之一。

分类：
- 对称密码(单钥密码体制)
- 非对称密码(双钥密码体制)，其中如果通过加密法则e<sub>k</sub>计算解密法则d<sub>k</sub>是困难的，即可以公开e<sub>k</sub>，则称为公钥密码体制。

保密通信的过程：
- 对于一个给定的密码体制，Bob和Alice必须随机选取一个密钥K，并通过安全信道传输(如见面交换K)，然后即可在不安全信道上通过约定好的加密体制进行加密解密。
![1-1](/xman/1-1.jpg)

密码分析的定义：
- 密码分析指的是对密码体制的攻击，一般情况下，假设我们已知正在使用的密码体制。
- 一个好的体制至少满足如下两个条件
	- 当已知明文和加密法则e<sub>k</sub>时，容易计算密文；当已知密文和解密法则d<sub>k</sub>时，容易计算明文。
	- 当不知道解密法则d<sub>k</sub>时，不可能或是极难计算出明文
- 对于一个密码体制，如果能够根据密文确定明文或密钥，或是根据部分明文和对应密文可以确定密钥，那么称这个密码是可破译的，反之称为不可破译的

密码分析的分类(攻击方式)：
- 穷举攻击
- 统计分析攻击
- 数学分析攻击
或
- 唯密文攻击
- 已知明文攻击
- 选择明文攻击
- 选择密文攻击

安全性：
- 计算安全性，密钥空间大小，防止穷举攻击
- 可证明安全性(理论上)，目前不存在
- 无条件安全性(理论上)

## 0x01 古典密码
单表代换加密：
- 明密文一一对应，可以采用暴力破解方式，明密文长度足够长可以采用[词频分析](http://quipqiup.com/)，若密钥空间足够大，密文足够短则难以破解。

理论基础：
- a和b的最大公约数：(a, b)
- 同余：a ≡ b (mod m)
- 如果任意整数都与S中一个元素关于m同余，则S是m的一个完全剩余系
- 在m的一个完全剩余系中有的与m互素，有的不互素，则S是m的既约剩余系
- 欧拉用φ(m)表示m的既约剩余系的元素个数
- 欧拉定理：设a为整数，m为正整数，如果 (a, m)=1 那么 a ^ φ(m) ≡ 1 (mod m)
- 欧拉函数计算公式：m的标准分解(分解质因数)为 m=p1^a1*p2^a2…… 则 φ(m)=m(1-1/p1)(1-p2)…… (RSA常用欧拉定理)，如果(a, m)=1，则一元一次同余方程 ax ≡ b (mod m) 有且只有一个解 x ≡ b * a ^ (φ(m)-1) (mod m)

移位密码：
- 字母按顺序对应数字
- 令P=C=K=Z<sub>26</sub>，对每个K及任意数x、y属于Z<sub>26</sub>，定义加密和解密：e<sub>k</sub>(x)=(x+k) mod 26，d<sub>k</sub>(y)=(y-k) mod 26
- K=3时，称为凯撒密码
- 安全性分析：
	- 移位密码不安全，密钥空间太小，只有26种可能

仿射密码：
- e<sub>k</sub>(x)=(ax+b) mod 26，d<sub>k</sub>(y)=a^11(y-b) mod 26  # 此处11为 φ(26)-1
- 为了能解密，必须保证仿射为单射，即同余方程ax+b≡y (mod 26)有唯一解，即(a, 26) = 1，a必须是不超过26且与26互素的整数，所以密钥空间为12*26=312，可用穷举攻击
- 可用词频分析攻击，[英文字母词频](https://en.wikipedia.org/wiki/Letter_frequency)，由H.Beker和F.Piper发表
![1-3](/xman/1-3.png)

简单替换密码：
- 暴力破解，密钥空间=26
- 字母表倒序替换为埃特巴什码

多表替换密码：
- 明文中不同位置同一字母在密文中字母不同

Playfair(多表替换)：
- 选取一串英文字母，除去重复字母，将剩下的字母逐个加入5x5的矩阵内，剩下的空间以未加入的字母a-z依次加入，去除q或将i和j视作同一个字母，将要加密的明文分为两个一组，若组内字母相同，或剩下一个字母，该组第二个字母为X，在每组中，找出两个字母在矩阵中的位置……
- 附：[算法详解](https://en.wikipedia.org/wiki/Playfair_cipher)

Polybius(棋盘密码，单表)：
- 将a-z填入5x5棋盘，i和j视作同一个字母，密文为字母在表中的位置
- 附：[算法详解](https://en.wikipedia.org/wiki/Autokey_cipher)

Nihilist(类似棋盘)：
- 多了一个关键字密钥，先将密钥放入，再按a-z填入

**polybius/Nihilist 纯数字，密文偶数**

Hill(希尔密码)：
- 使用每个字母表中的顺序作为数字，然后将明文转化为n维向量，和n*n的矩阵相乘，得到的向量模26

维吉尼亚密码：
- 设m为正整数，令P=C=K=Z26^m，e<sub>k</sub>(x1， x2...)=(x1+k1, x2+k2....) mod 26，d<sub>k</sub>(y1, y2...) = (y1-k1, ....) mod 26
- kasiski测试法：搜索长度为3的密文串，记录起始点和其余的距离，求公因数为密钥长度
- friedman重合指标法

Autokey Cipher：
- 与维吉尼亚密码类似，但是用不同的方法生成密钥，分为关键词自动密钥和原文自动密钥

培根密码：
- 培根密码使用两种不同的字符，代表A和B，结合加密表进行加解密，每段长度为5

栅栏密码：
- 把明文分为N个一组，然后把每组第一个字连起来，形成一段话

曲路密码：
- 一种换位密码，需要实现双方约定密钥(曲路路径)

列移位加密：
- 按密钥在字母表中的出现顺序编号

猪圈密码：
![1-4](/xman/1-4.jpg)

键盘密码：
- 采用手机键盘或电脑键盘加密

QWE加密：
- 把字母顺序按键盘排列，QWE=ABC

## 0x02 现代密码学
对称密码体制分类：
- 一次只对明文中单个位运算的算法称为序列算法，流密码
- 对明文的一组进行运算，这些组称为分组，称为分组算法，典型分组长度为64、128或更长

一般设计原理：
- 理想密码系统中，密文的所有统计特性都与密钥无关
- 混乱：使密文的统计特性与密钥的取值之间的关系尽量复杂
- 扩散：明文的统计结构被扩散消失到密文的长程统计特性，使明文与密文之间的统计关系尽量复杂

DES：
- Data Encryption Standard 由 IBM 研制， 分组加密算法。典型的DES以64位位分组数据加密，加密解密同一个算法(密钥可能不同)，密钥长度是56位(每个第八位用作奇偶校验)密钥可以是任意的56位数。输入64bit明文数据 -> 初始置换IP -> 在密钥控制下进行16轮迭代 -> 交换左右32bit -> 初始逆置换IP逆 -> 输出64bit密文数据。
- 初始置换IP：将输入的64位数据块按位重新组合，输出分为L0和R0两部分，每部分各长32位，搜索置换表
- 密钥置换：在56位密钥的每一轮迭代中产生48位子密钥，有置换表
- 16轮迭代：
	- E扩展置换，将两组32位数据扩展为48位
	- S盒代替，S盒是4行16位表，6*8位压缩为4*8位
	- P盒置换，把输入映射到输出
- IP逆末置换：将左右两部分
- 结构：Feistel
- 双重DES：
	- C=Ek2(Ek1(P)) P=Dk1(Dk2(C))
	- 双重DES存在中间相遇攻击，C=Ek2(Ek1(P)) -> X = Ek1(P) = Dk2(C)
- 三重DES

AES：
- Advance Encryption Standard
- 结构：
	- SP网络结构：轮输入首先被由子密钥控制的可逆函数S作用，然后再对所得结果进行置换……
- 算法结构：
	- 算法由三个不同的可逆一致变换组成

分组加密的四种模式：
- ECB、CBC、CFB、OFB

陷门单向函数：
- 设f是一个函数，对于任意x，计算y=fx是容易的，但对于给定y，计算fx=y是难解的，即求f的逆函数是难解的，则f是一个单向函数。设f是一个单项函数，t是与f有关的参数，如果已知t后，计算f的逆函数是容易的，则称f为陷门单向函数，t称为陷门

RSA：
- p和q是两个大素数，计算n=pq和φ(n)=(p-1)(q-1)，pqφ(n)保密，1<b<φ(n)，(b, φ(n)) = 1，ab === 1 (mod φ(n))，e<sub>k</sub>(x)=x^b mod n，d<sub>k</sub>(y)=y^a mod n
- 可能存在的问题：|p+q|和|p-q|过大或过小、模不互素
- 共模攻击
- 小公钥攻击，e特别小
- 私钥攻击 wiener
- 选择密文攻击

零知识证明：
- Bob用Alice的公钥随机加密一段数据，将密文发给Alice，ALice用私钥解密后将明文发送给Bob，如果内容相同，则证明对方确实是Alice
- 零知识证明协议由shamir在1985年发明

## 0x03 哈希函数(摘要)
输入任意长度数据，输出固定长度
鉴别消息是否可靠

MD5：
- 四个初始化变量A B C D
- 已被攻破

SHA1：
- 不可复原
- 两个不同消息不会产生同样的消息摘要，五个初始化变量 H0 H1 H2 H3 H4
- 以被Google攻破

## 0x04 另类密码——编码
ASCII
Base64、32、16
Quoted-printable编码
UUencode
URL编码
Unicode编码
utf8