<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         Raphael__
    -->
    <meta charset="utf-8" />
    <title>Python装饰器 | Raphael's Blog</title>
    <meta name="author" content="Raphael" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Raphael's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Raphael</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
    </div>

    <style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/coding/python-decorators" title="Python装饰器">Python装饰器</a></h1>
        <p class="entry-date">2015-04-19</p>
        <h2 id="函数式装饰器装饰器本身是一个函数">函数式装饰器:装饰器本身是一个函数。</h2>

<h3 id="装饰函数被装饰对象是一个函数">装饰函数:被装饰对象是一个函数</h3>

<p>一、装饰器无参数：</p>

<p>1.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">():</span>
<span class="lineno"> 3 </span>        <span class="k">print</span> <span class="s1">&#39;Call the function </span><span class="si">%s</span><span class="s1">().&#39;</span><span class="o">%</span><span class="n">func</span><span class="o">.</span><span class="n">func_name</span>
<span class="lineno"> 4 </span>        <span class="k">return</span> <span class="n">func</span><span class="p">()</span>
<span class="lineno"> 5 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 8 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span><span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">11 </span><span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">say</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">12 </span><span class="s1">&#39;hello world&#39;</span></code></pre></figure>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="k">print</span> <span class="s1">&#39;Call the function </span><span class="si">%s</span><span class="s1">().&#39;</span><span class="o">%</span><span class="n">func</span><span class="o">.</span><span class="n">func_name</span>
<span class="lineno"> 4 </span>        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 8 </span><span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="n">Str</span><span class="p">,</span><span class="n">Len</span><span class="p">):</span>
<span class="lineno"> 9 </span>    <span class="c1">#The parameters of _test can be &#39;(Str,Len)&#39; in this case.</span>
<span class="lineno">10 </span>    <span class="k">return</span> <span class="n">Str</span><span class="p">[:</span><span class="n">Len</span><span class="p">]</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">left</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">13 </span><span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">left</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">14 </span><span class="s1">&#39;hello&#39;</span></code></pre></figure>

<p>二、装饰器有参数：</p>

<p>2.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">printResult</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="k">def</span> <span class="nf">__test</span><span class="p">():</span>
<span class="lineno"> 4 </span>            <span class="k">print</span> <span class="s1">&#39;Call the function </span><span class="si">%s</span><span class="s1">().&#39;</span><span class="o">%</span><span class="n">func</span><span class="o">.</span><span class="n">func_name</span>
<span class="lineno"> 5 </span>            <span class="k">if</span> <span class="n">printResult</span><span class="p">:</span>
<span class="lineno"> 6 </span>                <span class="k">print</span> <span class="n">func</span><span class="p">()</span>
<span class="lineno"> 7 </span>            <span class="k">else</span><span class="p">:</span>
<span class="lineno"> 8 </span>                <span class="k">return</span> <span class="n">func</span><span class="p">()</span>
<span class="lineno"> 9 </span>        <span class="k">return</span> <span class="n">__test</span>
<span class="lineno">10 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="lineno">13 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span><span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">16 </span><span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">say</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">17 </span><span class="n">hello</span> <span class="n">world</span>
<span class="lineno">18 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="lineno">19 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span><span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">20 </span>
<span class="lineno">21 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">22 </span><span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">say</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">23 </span><span class="s1">&#39;hello world&#39;</span>
<span class="lineno">24 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">25 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span><span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">28 </span><span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">say</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">29 </span><span class="s1">&#39;hello world&#39;</span>
<span class="lineno">30 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno">31 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span><span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">32 </span>
<span class="lineno">33 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">34 </span>
<span class="lineno">35 </span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
<span class="lineno">36 </span>  <span class="n">File</span> <span class="s2">&quot;&lt;pyshell#224&gt;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="lineno">37 </span>    <span class="n">say</span><span class="p">()</span>
<span class="lineno">38 </span><span class="ne">TypeError</span><span class="p">:</span> <span class="n">_test</span><span class="p">()</span> <span class="n">takes</span> <span class="n">exactly</span> <span class="n">argument</span> <span class="p">(</span><span class="mi">0</span> <span class="n">given</span><span class="p">)</span></code></pre></figure>

<p>由上面这段代码中的最后两个例子可知：当装饰器有参数时，即使你启用装饰器的默认参数，不另外传递新值进去，也必须有一对括号，否则编译器会直接将func传递给test()，而不是传递给_test()</p>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">printResult</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="k">def</span> <span class="nf">__test</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 4 </span>            <span class="k">print</span> <span class="s1">&#39;Call the function </span><span class="si">%s</span><span class="s1">().&#39;</span><span class="o">%</span><span class="n">func</span><span class="o">.</span><span class="n">func_name</span>
<span class="lineno"> 5 </span>            <span class="k">if</span> <span class="n">printResult</span><span class="p">:</span>
<span class="lineno"> 6 </span>                <span class="k">print</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 7 </span>            <span class="k">else</span><span class="p">:</span>
<span class="lineno"> 8 </span>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 9 </span>        <span class="k">return</span> <span class="n">__test</span>
<span class="lineno">10 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">13 </span><span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="n">Str</span><span class="p">,</span><span class="n">Len</span><span class="p">):</span>
<span class="lineno">14 </span>    <span class="c1">#The parameters of __test can be &#39;(Str,Len)&#39; in this case.</span>
<span class="lineno">15 </span>    <span class="k">return</span> <span class="n">Str</span><span class="p">[:</span><span class="n">Len</span><span class="p">]</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">left</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">18 </span><span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">left</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">19 </span><span class="s1">&#39;hello&#39;</span>
<span class="lineno">20 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="lineno">21 </span><span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="n">Str</span><span class="p">,</span><span class="n">Len</span><span class="p">):</span>
<span class="lineno">22 </span>    <span class="c1">#The parameters of __test can be &#39;(Str,Len)&#39; in this case.</span>
<span class="lineno">23 </span>    <span class="k">return</span> <span class="n">Str</span><span class="p">[:</span><span class="n">Len</span><span class="p">]</span>
<span class="lineno">24 </span>
<span class="lineno">25 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">left</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">26 </span><span class="n">Call</span> <span class="n">the</span> <span class="n">function</span> <span class="n">left</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">27 </span><span class="n">hello</span></code></pre></figure>

<h3 id="装饰类被装饰的对象是一个类">装饰类：被装饰的对象是一个类</h3>

<p>一、装饰器无参数：</p>

<p>1.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">():</span>
<span class="lineno"> 3 </span>        <span class="n">clsName</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;(\w+)&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="lineno"> 4 </span>        <span class="k">print</span> <span class="s1">&#39;Call </span><span class="si">%s</span><span class="s1">.__init().&#39;</span><span class="o">%</span><span class="n">clsName</span>
<span class="lineno"> 5 </span>        <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>
<span class="lineno"> 6 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 9 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">10 </span>    <span class="n">value</span><span class="o">=</span><span class="mi">32</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>    
<span class="lineno">13 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">()</span>
<span class="lineno">14 </span><span class="n">Call</span> <span class="n">sy</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">15 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="lineno">16 </span><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">sy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000000002C3E390</span><span class="o">&gt;</span>
<span class="lineno">17 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span>
<span class="lineno">18 </span><span class="mi">32</span></code></pre></figure>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="n">clsName</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;(\w+)&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="lineno"> 4 </span>        <span class="k">print</span> <span class="s1">&#39;Call </span><span class="si">%s</span><span class="s1">.__init().&#39;</span><span class="o">%</span><span class="n">clsName</span>
<span class="lineno"> 5 </span>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 6 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 9 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">10 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="lineno">11 </span>                <span class="c1">#The parameters of _test can be &#39;(value)&#39; in this case.</span>
<span class="lineno">12 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">value</span>
<span class="lineno">13 </span>     
<span class="lineno">14 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
<span class="lineno">15 </span><span class="n">Call</span> <span class="n">sy</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">16 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="lineno">17 </span><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">sy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000000003AF7748</span><span class="o">&gt;</span>
<span class="lineno">18 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span>
<span class="lineno">19 </span><span class="s1">&#39;hello world&#39;</span></code></pre></figure>

<p>二、装饰器有参数：</p>

<p>1.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">printValue</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="k">def</span> <span class="nf">__test</span><span class="p">():</span>
<span class="lineno"> 4 </span>            <span class="n">clsName</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;(\w+)&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="lineno"> 5 </span>            <span class="k">print</span> <span class="s1">&#39;Call </span><span class="si">%s</span><span class="s1">.__init().&#39;</span><span class="o">%</span><span class="n">clsName</span>
<span class="lineno"> 6 </span>            <span class="n">obj</span><span class="o">=</span><span class="bp">cls</span><span class="p">()</span>
<span class="lineno"> 7 </span>            <span class="k">if</span> <span class="n">printValue</span><span class="p">:</span>
<span class="lineno"> 8 </span>                <span class="k">print</span> <span class="s1">&#39;value = </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="lineno"> 9 </span>            <span class="k">return</span> <span class="n">obj</span>
<span class="lineno">10 </span>        <span class="k">return</span> <span class="n">__test</span>
<span class="lineno">11 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">14 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">15 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">16 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="mi">32</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>        
<span class="lineno">19 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">()</span>
<span class="lineno">20 </span><span class="n">Call</span> <span class="n">sy</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">21 </span><span class="n">value</span> <span class="o">=</span> <span class="mi">32</span>
<span class="lineno">22 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="lineno">23 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">24 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">25 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="mi">32</span>
<span class="lineno">26 </span>
<span class="lineno">27 </span>        
<span class="lineno">28 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">()</span>
<span class="lineno">29 </span><span class="n">Call</span> <span class="n">sy</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span><span class="o">.</span></code></pre></figure>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">printValue</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="k">def</span> <span class="nf">__test</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 4 </span>            <span class="n">clsName</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;(\w+)&#39;</span><span class="p">,</span><span class="nb">repr</span><span class="p">(</span><span class="bp">cls</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="lineno"> 5 </span>            <span class="k">print</span> <span class="s1">&#39;Call </span><span class="si">%s</span><span class="s1">.__init().&#39;</span><span class="o">%</span><span class="n">clsName</span>
<span class="lineno"> 6 </span>            <span class="n">obj</span><span class="o">=</span><span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 7 </span>            <span class="k">if</span> <span class="n">printValue</span><span class="p">:</span>
<span class="lineno"> 8 </span>                <span class="k">print</span> <span class="s1">&#39;value = </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="lineno"> 9 </span>            <span class="k">return</span> <span class="n">obj</span>
<span class="lineno">10 </span>        <span class="k">return</span> <span class="n">__test</span>
<span class="lineno">11 </span>    <span class="k">return</span> <span class="n">_test</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">14 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">15 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="lineno">16 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">value</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>        
<span class="lineno">19 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
<span class="lineno">20 </span><span class="n">Call</span> <span class="n">sy</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span><span class="o">.</span>
<span class="lineno">21 </span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">22 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="lineno">23 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">24 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="lineno">25 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">value</span>
<span class="lineno">26 </span>       
<span class="lineno">27 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
<span class="lineno">28 </span><span class="n">Call</span> <span class="n">sy</span><span class="o">.</span><span class="n">__init</span><span class="p">()</span><span class="o">.</span></code></pre></figure>

<h2 id="类式装饰器装饰器本身是一个类借用__init__和__call__来实现职能">类式装饰器：装饰器本身是一个类，借用__init__()和__call__()来实现职能</h2>

<h3 id="装饰函数被装饰对象是一个函数-1">装饰函数：被装饰对象是一个函数</h3>

<p>一、装饰器无参数：</p>

<p>1.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="o">=</span><span class="n">func</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">()</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    
<span class="lineno"> 8 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 9 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span>
<span class="lineno">10 </span>    <span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">13 </span><span class="s1">&#39;hello world&#39;</span></code></pre></figure>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="o">=</span><span class="n">func</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    
<span class="lineno"> 8 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 9 </span><span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="n">Str</span><span class="p">,</span><span class="n">Len</span><span class="p">):</span>
<span class="lineno">10 </span>    <span class="c1">#The parameters of __call__ can be &#39;(self,Str,Len)&#39; in this case.</span>
<span class="lineno">11 </span>    <span class="k">return</span> <span class="n">Str</span><span class="p">[:</span><span class="n">Len</span><span class="p">]</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">left</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">14 </span><span class="s1">&#39;hello&#39;</span></code></pre></figure>

<p>二、装饰器有参数</p>

<p>1.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">beforeinfo</span><span class="o">=</span><span class="s1">&#39;Call function&#39;</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span><span class="o">=</span><span class="n">beforeinfo</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">def</span> <span class="nf">_call</span><span class="p">():</span>
<span class="lineno"> 6 </span>            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span>
<span class="lineno"> 7 </span>            <span class="k">return</span> <span class="n">func</span><span class="p">()</span>
<span class="lineno"> 8 </span>        <span class="k">return</span> <span class="n">_call</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>    
<span class="lineno">11 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">12 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span>
<span class="lineno">13 </span>    <span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">16 </span><span class="n">Call</span> <span class="n">function</span>
<span class="lineno">17 </span><span class="s1">&#39;hello world&#39;</span></code></pre></figure>

<p>或者：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">beforeinfo</span><span class="o">=</span><span class="s1">&#39;Call function&#39;</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span><span class="o">=</span><span class="n">beforeinfo</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="o">=</span><span class="n">func</span>
<span class="lineno"> 6 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call</span>
<span class="lineno"> 7 </span>    <span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 8 </span>        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span>
<span class="lineno"> 9 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">()</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>    
<span class="lineno">12 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">13 </span><span class="k">def</span> <span class="nf">say</span><span class="p">():</span>
<span class="lineno">14 </span>    <span class="k">return</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">say</span><span class="p">()</span>
<span class="lineno">17 </span><span class="n">Call</span> <span class="n">function</span>
<span class="lineno">18 </span><span class="s1">&#39;hello world&#39;</span></code></pre></figure>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">beforeinfo</span><span class="o">=</span><span class="s1">&#39;Call function&#39;</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span><span class="o">=</span><span class="n">beforeinfo</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 6 </span>            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span>
<span class="lineno"> 7 </span>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 8 </span>        <span class="k">return</span> <span class="n">_call</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>    
<span class="lineno">11 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">12 </span><span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="n">Str</span><span class="p">,</span><span class="n">Len</span><span class="p">):</span>
<span class="lineno">13 </span>    <span class="c1">#The parameters of _call can be &#39;(Str,Len)&#39; in this case.</span>
<span class="lineno">14 </span>    <span class="k">return</span> <span class="n">Str</span><span class="p">[:</span><span class="n">Len</span><span class="p">]</span>
<span class="lineno">15 </span>
<span class="lineno">16 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">left</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">17 </span><span class="n">Call</span> <span class="n">function</span>
<span class="lineno">18 </span><span class="s1">&#39;hello&#39;</span></code></pre></figure>

<p>或者：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">beforeinfo</span><span class="o">=</span><span class="s1">&#39;Call function&#39;</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span><span class="o">=</span><span class="n">beforeinfo</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">func</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="o">=</span><span class="n">func</span>
<span class="lineno"> 6 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call</span>
<span class="lineno"> 7 </span>    <span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 8 </span>        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">beforeInfo</span>
<span class="lineno"> 9 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span>    
<span class="lineno">12 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">()</span>
<span class="lineno">13 </span><span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="n">Str</span><span class="p">,</span><span class="n">Len</span><span class="p">):</span>
<span class="lineno">14 </span>    <span class="c1">#The parameters of _call can be &#39;(self,Str,Len)&#39; in this case.</span>
<span class="lineno">15 </span>    <span class="k">return</span> <span class="n">Str</span><span class="p">[:</span><span class="n">Len</span><span class="p">]</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">left</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="lineno">18 </span><span class="n">Call</span> <span class="n">function</span>
<span class="lineno">19 </span><span class="s1">&#39;hello&#39;</span></code></pre></figure>

<h3 id="装饰类被装饰对象是一个类">装饰类：被装饰对象是一个类</h3>

<p>一、装饰器无参数：</p>

<p>1.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_cls</span><span class="o">=</span><span class="bp">cls</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls</span><span class="p">()</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    
<span class="lineno"> 8 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 9 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">10 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">11 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="mi">32</span>
<span class="lineno">12 </span>
<span class="lineno">13 </span>    
<span class="lineno">14 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">()</span>
<span class="lineno">15 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="lineno">16 </span><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">sy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000000003AAFA20</span><span class="o">&gt;</span>
<span class="lineno">17 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span>
<span class="lineno">18 </span><span class="mi">32</span></code></pre></figure>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_cls</span><span class="o">=</span><span class="bp">cls</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span>    
<span class="lineno"> 8 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span>
<span class="lineno"> 9 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">10 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="lineno">11 </span>        <span class="c1">#The parameters of __call__ can be &#39;(self,value)&#39; in this case.</span>
<span class="lineno">12 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">value</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span>        
<span class="lineno">15 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
<span class="lineno">16 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="lineno">17 </span><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">sy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000000003AAFA20</span><span class="o">&gt;</span>
<span class="lineno">18 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span>
<span class="lineno">19 </span><span class="s1">&#39;hello world&#39;</span></code></pre></figure>

<p>二、装饰器有参数：</p>

<p>1.被装饰对象无参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">printValue</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_printValue</span><span class="o">=</span><span class="n">printValue</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">def</span> <span class="nf">_call</span><span class="p">():</span>
<span class="lineno"> 6 </span>            <span class="n">obj</span><span class="o">=</span><span class="bp">cls</span><span class="p">()</span>
<span class="lineno"> 7 </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printValue</span><span class="p">:</span>
<span class="lineno"> 8 </span>                <span class="k">print</span> <span class="s1">&#39;value = </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="lineno"> 9 </span>            <span class="k">return</span> <span class="n">obj</span>
<span class="lineno">10 </span>        <span class="k">return</span> <span class="n">_call</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>    
<span class="lineno">13 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="lineno">14 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">15 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="lineno">16 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="mi">32</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>        
<span class="lineno">19 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">()</span>
<span class="lineno">20 </span><span class="n">value</span> <span class="o">=</span> <span class="mi">32</span>
<span class="lineno">21 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="lineno">22 </span><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">sy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000000003AB50B8</span><span class="o">&gt;</span>
<span class="lineno">23 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span>
<span class="lineno">24 </span><span class="mi">32</span></code></pre></figure>

<p>2.被装饰对象有参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="o">&gt;&gt;&gt;</span> <span class="k">class</span> <span class="nc">test</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">printValue</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">_printValue</span><span class="o">=</span><span class="n">printValue</span>
<span class="lineno"> 4 </span>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">cls</span><span class="p">):</span>
<span class="lineno"> 5 </span>        <span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="lineno"> 6 </span>            <span class="n">obj</span><span class="o">=</span><span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="lineno"> 7 </span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printValue</span><span class="p">:</span>
<span class="lineno"> 8 </span>                <span class="k">print</span> <span class="s1">&#39;value = </span><span class="si">%r</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">obj</span><span class="o">.</span><span class="n">value</span>
<span class="lineno"> 9 </span>            <span class="k">return</span> <span class="n">obj</span>
<span class="lineno">10 </span>        <span class="k">return</span> <span class="n">_call</span>
<span class="lineno">11 </span>
<span class="lineno">12 </span>    
<span class="lineno">13 </span><span class="o">&gt;&gt;&gt;</span> <span class="nd">@test</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="lineno">14 </span><span class="k">class</span> <span class="nc">sy</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="lineno">15 </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
<span class="lineno">16 </span>        <span class="c1">#The parameters of _call can be &#39;(value)&#39; in this case.</span>
<span class="lineno">17 </span>        <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">value</span>
<span class="lineno">18 </span>
<span class="lineno">19 </span>        
<span class="lineno">20 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">=</span><span class="n">sy</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>
<span class="lineno">21 </span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;hello world&#39;</span>
<span class="lineno">22 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="lineno">23 </span><span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">sy</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x0000000003AB5588</span><span class="o">&gt;</span>
<span class="lineno">24 </span><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span>
<span class="lineno">25 </span><span class="s1">&#39;hello world&#39;</span></code></pre></figure>

<h2 id="总结">总结：</h2>
<ul>
  <li>
    <p>@decorator后面不带括号时（也即装饰器无参数时），效果就相当于先定义func或cls，而后执行赋值操作func=decorator(func)或cls=decorator(cls)；</p>
  </li>
  <li>
    <p>@decorator后面带括号时（也即装饰器有参数时），效果就相当于先定义func或cls，而后执行赋值操作 func=decorator(decoratorArgs)(func)或cls=decorator(decoratorArgs)(cls)；</p>
  </li>
  <li>
    <p>如上将func或cls重新赋值后，此时的func或cls也不再是原来定义时的func或cls，而是一个可执行体，你只需要传入参数就可调用，func(args)=&gt;返回值或者输出，cls(args)=&gt;object of cls；</p>
  </li>
  <li>
    <p>最后通过赋值返回的执行体是多样的，可以是闭包，也可以是外部函数；当被装饰的是一个类时，还可以是类内部方法，函数；</p>
  </li>
  <li>
    <p>另外要想真正了解装饰器，一定要了解func.func_code.co_varnames,func.func_defaults,func.func_argcount，通过它们你可以以func的定义之外，还原func的参数列表，详见Python多重装饰器中的最后一个例子中的ArgsType；另外关键字参数是因为调用而出现的，而不是因为func的定义，func的定义中的用等号连接的只是有默认值的参数，它们并不一定会成为关键字参数，因为你仍然可以按照位置来传递它们。</p>
  </li>
</ul>

        <div id="disqus_thread"></div>
		<script type="text/javascript">
		    /* * * CONFIGURATION VARIABLES * * */
		    var disqus_shortname = 'albus12138';
		    
		    /* * * DON'T EDIT BELOW THIS LINE * * */
		    (function() {
		        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		    })();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/blog/why-blog">我为什么写博客？</a></li>
            
            
        
        </ul>

        <h2>Coding</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/coding/python-re">Python正则表达式</a></li>
            
            
        
            
            <li><a href="/coding/xctf-carnival-wp">XCTF嘉年华体验赛 Re部分WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/gctf-wp">GCTF Re&Mobile WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/python-requests">Requests模块</a></li>
            
            
        
            
            <li><a href="/coding/iscc-2017-wp">ISCC2017 WriteUp</a></li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        </ul>

        <h2>Bookmarks</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/bookmarks/ddos">免费DDOS攻击测试工具</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking-2">网络流量攻击的危害</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking">网络流量攻击</a></li>
            
            
        
            
            <li><a href="/bookmarks/resouces-for-learn-python">学习Python编程的11个资源</a></li>
            
            
        
            
            <li><a href="/bookmarks/buffer-overflow">缓冲区溢出攻击相关知识</a></li>
            
            
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();
            });
        })
        $(document).ready(function(){
            var id = Math.floor(Math.random()*5)+1;
            $(".aside").css("background-image","url(/images/bg-"+id+".jpg)");            
        })
    </script>
</body>
</html>
