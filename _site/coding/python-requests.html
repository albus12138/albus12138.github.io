<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         Raphael__
    -->
    <meta charset="utf-8" />
    <title>Requests模块 | Raphael's Blog</title>
    <meta name="author" content="Raphael" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Raphael's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Raphael</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
    </div>

    <style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/coding/python-requests" title="Requests模块">Requests模块</a></h1>
        <p class="entry-date">2017-06-25</p>
        <h2 id="0x00-环境安装">0x00 环境安装</h2>

<blockquote>
  <pre><code>pip install requests
</code></pre>
</blockquote>

<p>或源码安装</p>

<blockquote>
  <pre><code>git clone git://github.com/kennethreitz/requests.git
cd requests
python setup.py install
</code></pre>
</blockquote>

<h2 id="0x01-发送请求">0x01 发送请求</h2>

<p>使用requests库发送HTTP请求非常简单，API写的恰当好处</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="kn">import</span> <span class="nn">requests</span>
<span class="lineno">2 </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io&quot;</span><span class="p">)</span>
<span class="lineno">3 </span><span class="c1"># r = requests.get(&quot;http://albus12138.github.io&quot;, timeout=5) 设置5秒超时</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io&quot;</span><span class="p">)</span>
<span class="lineno">6 </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io&quot;</span><span class="p">)</span>
<span class="lineno">7 </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io&quot;</span><span class="p">)</span>
<span class="lineno">8 </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io&quot;</span><span class="p">)</span></code></pre></figure>

<p>这里我们就得到了一个命名为<code>r</code>的response对象</p>

<ul>
  <li>
    <p>r.content – 以字节方式获取相应内容</p>
  </li>
  <li>
    <p>r.cookies – 以字典(CookieJar)的方式获取相应的Cookies</p>
  </li>
  <li>
    <p>r.encoding – 相应内容编码格式</p>
  </li>
  <li>
    <p>r.headers – 以字典的方式获取响应头</p>
  </li>
  <li>
    <p>r.is_permanent_redirect – 响应状态是否为 301 永久重定向</p>
  </li>
  <li>
    <p>r.is_redirect – 响应状态是否为 302 重定向</p>
  </li>
  <li>
    <p>r.json – 调用requests内置的json解析器，将响应内容解析为json，失败时会抛出异常</p>
  </li>
  <li>
    <p>r.raw – 获取原始响应内容，如果你想要这样做，请在get时添加stream=True参数</p>
  </li>
  <li>
    <p>r.request – 获取对应的请求对象</p>
  </li>
  <li>
    <p>r.status_code – 获取响应状态码</p>
  </li>
  <li>
    <p>r.text – 以字符串方式获取响应内容</p>
  </li>
  <li>
    <p>r.url – 获取请求地址</p>
  </li>
</ul>

<h2 id="0x02-添加参数">0x02 添加参数</h2>

<p>添加URL参数，手动构造如<code>example.com/index?param=abc</code>的URL十分繁琐，在requests中可以使用params传入字典参数，自动生成带参数的URL</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
<span class="lineno">2 </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="lineno">3 </span><span class="c1"># 这里可以通过 r.url 获取生成好的URL</span></code></pre></figure>

<p>注意：字典中值为<code>None</code>的参数不会被添加到URL中</p>

<p>添加POST参数：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
<span class="lineno">2 </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
<span class="lineno">3 </span><span class="c1"># r.text</span></code></pre></figure>

<h2 id="0x03-使用会话">0x03 使用会话</h2>

<p>有时候我们想要请求的内容需要登陆后访问，如果手动添加cookie十分不便，这种情况下使用会话可以有效节省精力，专注于一些更重要的内容</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="n">sess</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="lineno">2 </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usr&quot;</span><span class="p">:</span> <span class="s2">&quot;albus&quot;</span><span class="p">,</span> <span class="s2">&quot;pwd&quot;</span><span class="p">:</span> <span class="s2">&quot;albus&quot;</span><span class="p">}</span>
<span class="lineno">3 </span><span class="n">r</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io/login&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
<span class="lineno">4 </span><span class="n">r</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://albus12138.github.io/admin&quot;</span><span class="p">)</span></code></pre></figure>

<h2 id="0x04-使用代理访问">0x04 使用代理访问</h2>

<p>如果想要使用代理，可以为请求添加<code>proxies</code>参数</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
<span class="lineno">2 </span>	<span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="s2">&quot;http://10.10.1.10:3128&quot;</span><span class="p">,</span>
<span class="lineno">3 </span>	<span class="s2">&quot;https&quot;</span><span class="p">:</span> <span class="s2">&quot;https//10.10.1.10:3129&quot;</span><span class="p">,</span>
<span class="lineno">4 </span>	<span class="s2">&quot;http&quot;</span><span class="p">:</span> <span class="s2">&quot;http://user:pass@10.10.1.10:3128/&quot;</span><span class="p">,</span>
<span class="lineno">5 </span>	<span class="s1">&#39;http&#39;</span><span class="p">:</span> <span class="s1">&#39;socks5://user:pass@host:port&#39;</span>
<span class="lineno">6 </span><span class="p">}</span></code></pre></figure>

        <div id="disqus_thread"></div>
		<script type="text/javascript">
		    /* * * CONFIGURATION VARIABLES * * */
		    var disqus_shortname = 'albus12138';
		    
		    /* * * DON'T EDIT BELOW THIS LINE * * */
		    (function() {
		        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		    })();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/blog/why-blog">我为什么写博客？</a></li>
            
            
        
        </ul>

        <h2>Coding</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/coding/python-re">Python正则表达式</a></li>
            
            
        
            
            <li><a href="/coding/xctf-carnival-wp">XCTF嘉年华体验赛 Re部分WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/gctf-wp">GCTF Re&Mobile WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/python-requests">Requests模块</a></li>
            
            
        
            
            <li><a href="/coding/iscc-2017-wp">ISCC2017 WriteUp</a></li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        </ul>

        <h2>Bookmarks</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/bookmarks/ddos">免费DDOS攻击测试工具</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking-2">网络流量攻击的危害</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking">网络流量攻击</a></li>
            
            
        
            
            <li><a href="/bookmarks/resouces-for-learn-python">学习Python编程的11个资源</a></li>
            
            
        
            
            <li><a href="/bookmarks/buffer-overflow">缓冲区溢出攻击相关知识</a></li>
            
            
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();
            });
        })
        $(document).ready(function(){
            var id = Math.floor(Math.random()*5)+1;
            $(".aside").css("background-image","url(/images/bg-"+id+".jpg)");            
        })
    </script>
</body>
</html>
