<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         Raphael__
    -->
    <meta charset="utf-8" />
    <title>XCTF嘉年华体验赛 Re部分WriteUp | Raphael's Blog</title>
    <meta name="author" content="Raphael" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Raphael's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Raphael</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
    </div>

    <style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/coding/xctf-carnival-wp" title="XCTF嘉年华体验赛 Re部分WriteUp">XCTF嘉年华体验赛 Re部分WriteUp</a></h1>
        <p class="entry-date">2017-07-01</p>
        <h2 id="0x00-re1">0x00 Re1</h2>

<p>题目比较简单，用IDA反编译出伪代码</p>

<p><img src="/images/xctf-carnival-wp/1.jpg" alt="main" /></p>

<p>可以看出，flag是一个4位纯数字字符串<code>abcd</code>，其中可以从if条件得出4个限制条件，相当于解一个四元一次方程组</p>

<ul>
  <li>
    <p>a+b+c+d = 23</p>
  </li>
  <li>
    <p>c div d = 2</p>
  </li>
  <li>
    <p>b-c = 1</p>
  </li>
  <li>
    <p>a mod c = 3</p>
  </li>
</ul>

<p>不难算出结果，flag：9563</p>

<p>不想动笔算的话就写个爆破脚本好了</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="lineno"> 2 </span>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="lineno"> 3 </span>        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="lineno"> 4 </span>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
<span class="lineno"> 5 </span>                <span class="k">if</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">+</span><span class="n">d</span> <span class="o">!=</span> <span class="mi">23</span><span class="p">:</span>
<span class="lineno"> 6 </span>                    <span class="k">continue</span>
<span class="lineno"> 7 </span>                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 除数不能为0</span>
<span class="lineno"> 8 </span>                    <span class="k">continue</span>
<span class="lineno"> 9 </span>                <span class="k">if</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<span class="lineno">10 </span>                    <span class="k">continue</span>
<span class="lineno">11 </span>                <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<span class="lineno">12 </span>                    <span class="k">continue</span>
<span class="lineno">13 </span>                <span class="k">if</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
<span class="lineno">14 </span>                    <span class="k">continue</span>
<span class="lineno">15 </span>                <span class="k">print</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span></code></pre></figure>

<h2 id="0x01-re2">0x01 Re2</h2>

<p>这是AlexCTF的一道原题，用IDA生成伪代码后先看看main函数</p>

<p><img src="/images/xctf-carnival-wp/2.jpg" alt="main" /></p>

<p>题目设置了两个非常长的sleep，很不友好，需要破解的内容分别是username和password，不难看出一共涉及到了5个函数</p>

<p><em>sub_400C9A</em>:</p>

<p><img src="/images/xctf-carnival-wp/3.jpg" alt="400C9A" /></p>

<p>一个获取字符串长度的函数，并将长度传入<code>sub_400C41</code>进一步运算</p>

<p><em>sub_400C41</em>:</p>

<p><img src="/images/xctf-carnival-wp/4.jpg" alt="400C41" /></p>

<p>通过四个条件限制字符串长度，因为涉及到了unsigned int，这里选择用c++写爆破脚本，得出结果，username长度为8或12</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span></span><span class="lineno"> 1 </span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="lineno"> 2 </span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
<span class="lineno"> 5 </span>	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
<span class="lineno"> 6 </span>	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">49</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
<span class="lineno"> 7 </span>		<span class="n">result</span> <span class="o">=</span> <span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">;</span>
<span class="lineno"> 8 </span>		<span class="k">if</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">!=</span><span class="n">i</span> <span class="o">||</span> <span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">!=</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">2</span> <span class="o">||</span> <span class="o">!</span><span class="n">result</span> <span class="o">||</span> <span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">){}</span>
<span class="lineno"> 9 </span>		<span class="k">else</span><span class="p">{</span>
<span class="lineno">10 </span>			<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="lineno">11 </span>		<span class="p">}</span>
<span class="lineno">12 </span>	<span class="p">}</span>
<span class="lineno">13 </span><span class="p">}</span></code></pre></figure>

<p><em>sub_400CDD</em>:</p>

<p><img src="/images/xctf-carnival-wp/5.jpg" alt="400CDD" /></p>

<p>DWORD是双字类型，长度为4字节，这里用DWORD从字符串中截取出4个字符，也就是分段检验，通过if的条件不难算出v2、v3、v4的值，转换为hex即为username字符串。这里要注意一点，IntelCPU采用的是小端序，所以存储的值与实际的值是相反的，需要对解出的4位字符串进行反转。</p>

<p><em>sub_4008F7</em>:</p>

<p><img src="/images/xctf-carnival-wp/6.jpg" alt="4008F7" /></p>

<p>这个函数对username进行了逐位检验，允许的字符为小写字母和_，其实上一个函数中已经解出正确的username，这里检验意义不大</p>

<p><em>sub_400977</em>:</p>

<p><img src="/images/xctf-carnival-wp/7.jpg" alt="400977" />
<img src="/images/xctf-carnival-wp/8.jpg" alt="400977" /></p>

<p>首先是对字符进行检验，允许的字符为大小写字母和数字，然后同样是一个分段检验，这里用到一个伪随机，种子为打乱顺序的之前解出的username，写一个c++脚本输出一下伪随机的前十个值，与对应结果进行运算，即可得到password。</p>

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span></span><span class="lineno"> 1 </span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="lineno"> 2 </span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="lineno"> 3 </span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="lineno"> 4 </span>
<span class="lineno"> 5 </span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
<span class="lineno"> 6 </span>	<span class="n">srand</span><span class="p">(</span><span class="mh">0x454D3E2E</span><span class="p">);</span>
<span class="lineno"> 7 </span>	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="lineno"> 8 </span>		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">rand</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="lineno"> 9 </span>	<span class="p">}</span>
<span class="lineno">10 </span><span class="p">}</span></code></pre></figure>

<p><em>sub_400876</em>:</p>

<p><img src="/images/xctf-carnival-wp/9.jpg" alt="400876" /></p>

<p>这里其实是一个输出正确flag的函数，这里的字符串s不知道在哪里，是不是与username和password有关，一开始也想过直接解开这个函数得到flag，但是没有思路，最后也没有逆向这个函数。</p>

<p>将上面算出的username和password写入程序中，经过漫长的等待（这里画个圈圈诅咒出题人），得到答案 your flag is: ALEXCTF{1_t41d_y0u_y0u_ar3__gr34t__reverser__s33}</p>

        <div id="disqus_thread"></div>
		<script type="text/javascript">
		    /* * * CONFIGURATION VARIABLES * * */
		    var disqus_shortname = 'albus12138';
		    
		    /* * * DON'T EDIT BELOW THIS LINE * * */
		    (function() {
		        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		    })();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/blog/why-blog">我为什么写博客？</a></li>
            
            
        
        </ul>

        <h2>Coding</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/coding/python-re">Python正则表达式</a></li>
            
            
        
            
            <li><a href="/coding/xctf-carnival-wp">XCTF嘉年华体验赛 Re部分WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/gctf-wp">GCTF Re&Mobile WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/python-requests">Requests模块</a></li>
            
            
        
            
            <li><a href="/coding/iscc-2017-wp">ISCC2017 WriteUp</a></li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        </ul>

        <h2>Bookmarks</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/bookmarks/ddos">免费DDOS攻击测试工具</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking-2">网络流量攻击的危害</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking">网络流量攻击</a></li>
            
            
        
            
            <li><a href="/bookmarks/resouces-for-learn-python">学习Python编程的11个资源</a></li>
            
            
        
            
            <li><a href="/bookmarks/buffer-overflow">缓冲区溢出攻击相关知识</a></li>
            
            
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();
            });
        })
        $(document).ready(function(){
            var id = Math.floor(Math.random()*5)+1;
            $(".aside").css("background-image","url(/images/bg-"+id+".jpg)");            
        })
    </script>
</body>
</html>
