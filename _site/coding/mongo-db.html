<!DOCTYPE html>
<html>
<head>
    <!--
    * Author:         Raphael__
    -->
    <meta charset="utf-8" />
    <title>MongoDB基础 | Raphael's Blog</title>
    <meta name="author" content="Raphael" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Raphael's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

    <div class="home-menu">
        <div class="home-icon-con">
            <a class="home-menu-icon" href="/">Raphael</a>
            <a class="home-follow" href="#" title="Contact Me">+</a>
        </div>
    </div>

    <style type="text/css">
    body { background:#e8e8e8; }
    @media screen and (max-width: 750px){
        body { background:#fff; }
    }
    @media screen and (max-width: 1020px){
        body { background:#fff; }
    }
</style>

<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/coding/mongo-db" title="MongoDB基础">MongoDB基础</a></h1>
        <p class="entry-date">2015-04-10</p>
        <h2 id="连接数据库">连接数据库</h2>

<h3 id="mongoclient--connection">MongoClient &amp; Connection</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span>    <span class="k">class</span> <span class="nc">MongoClient</span><span class="p">(</span><span class="n">pymongo</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">BaseObject</span><span class="p">)</span>
<span class="lineno"> 2 </span>     <span class="o">|</span>  <span class="n">Connection</span> <span class="n">to</span> <span class="n">MongoDB</span><span class="o">.</span>
<span class="lineno"> 3 </span>     <span class="o">|</span>
<span class="lineno"> 4 </span>     <span class="o">|</span>  <span class="n">Method</span> <span class="n">resolution</span> <span class="n">order</span><span class="p">:</span>
<span class="lineno"> 5 </span>     <span class="o">|</span>      <span class="n">MongoClient</span>
<span class="lineno"> 6 </span>     <span class="o">|</span>      <span class="n">pymongo</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">BaseObject</span>
<span class="lineno"> 7 </span>     <span class="o">|</span>      <span class="n">__builtin__</span><span class="o">.</span><span class="n">object</span>
<span class="lineno"> 8 </span>     <span class="o">|</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span> 
<span class="lineno">11 </span>
<span class="lineno">12 </span>    <span class="k">class</span> <span class="nc">Connection</span><span class="p">(</span><span class="n">pymongo</span><span class="o">.</span><span class="n">mongo_client</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">)</span>
<span class="lineno">13 </span>     <span class="o">|</span>  <span class="n">Connection</span> <span class="n">to</span> <span class="n">MongoDB</span><span class="o">.</span>
<span class="lineno">14 </span>     <span class="o">|</span>
<span class="lineno">15 </span>     <span class="o">|</span>  <span class="n">Method</span> <span class="n">resolution</span> <span class="n">order</span><span class="p">:</span>
<span class="lineno">16 </span>     <span class="o">|</span>      <span class="n">Connection</span>
<span class="lineno">17 </span>     <span class="o">|</span>      <span class="n">pymongo</span><span class="o">.</span><span class="n">mongo_client</span><span class="o">.</span><span class="n">MongoClient</span>
<span class="lineno">18 </span>     <span class="o">|</span>      <span class="n">pymongo</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">BaseObject</span>
<span class="lineno">19 </span>     <span class="o">|</span>      <span class="n">__builtin__</span><span class="o">.</span><span class="n">object</span></code></pre></figure>

<p>从这两个类的继承来看，connection是继承了MongoClient的，建议使用MongoClient而不是使用Connection。（也就是说，MongoClient可以使用方法Connection都可以使用）</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="lineno">2 </span><span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s2">&quot;192.168.40.87&quot;</span><span class="p">,</span> <span class="mi">27037</span><span class="p">)</span>
<span class="lineno">3 </span><span class="n">db_name</span> <span class="o">=</span> <span class="s2">&quot;TCL_Useraction&quot;</span>
<span class="lineno">4 </span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="n">db_name</span><span class="p">]</span>
<span class="lineno">5 </span><span class="n">collection_useraction</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s2">&quot;useraction&quot;</span><span class="p">]</span></code></pre></figure>

<p>这里是通过字典的方式访问数据库和集合，同时你也可以通过.（点号）的方式访问</p>

<h2 id="插入数据">插入数据</h2>

<h3 id="save--insert">save() &amp; insert()</h3>

<p>mongodb的save和insert函数都可以向collection里插入数据，但两者是有两个区别：</p>

<blockquote>
  <p>save函数实际就是根据参数条件,调用了insert或update函数.如果想插入的数据对象存在,insert函数会报错,而save函数是改变原来的对象;如果想插入的对象不存在,那么它们执行相同的插入操作.这里可以用几个字来概括它们两的区别,即所谓”有则改之,无则加之”.</p>
</blockquote>

<blockquote>
  <p>insert可以一次性插入一个列表，而不用遍历，效率高， save则需要遍历列表，一个个插入。</p>
</blockquote>

<h2 id="更新数据">更新数据</h2>

<p>对于单个数据来说，可以更新后使用save方法</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="n">update</span><span class="p">(</span><span class="n">criteria</span><span class="p">,</span> <span class="n">objNew</span><span class="p">,</span> <span class="n">upsert</span><span class="p">,</span> <span class="n">mult</span><span class="p">)</span>
<span class="lineno">2 </span>    <span class="n">criteria</span><span class="p">:</span> <span class="err">需要被更新的条件表达式</span>
<span class="lineno">3 </span>    <span class="n">objNew</span><span class="p">:</span> <span class="err">更新表达式</span>
<span class="lineno">4 </span>    <span class="n">upsert</span><span class="p">:</span> <span class="err">如目标记录不存在，是否插入新文档。</span>
<span class="lineno">5 </span>    <span class="n">multi</span><span class="p">:</span> <span class="err">是否更新多个文档。</span>
<span class="lineno">6 </span>
<span class="lineno">7 </span>    <span class="n">collection_useraction</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;gid&quot;</span><span class="p">:</span><span class="n">last_gid</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="n">l_date</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:{</span><span class="s2">&quot;gid&quot;</span><span class="p">:</span><span class="n">last_gid</span><span class="p">},</span> <span class="s2">&quot;$set&quot;</span><span class="p">:{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span><span class="n">l_date</span><span class="p">},</span> <span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;categories&quot;</span><span class="p">:</span><span class="n">category_data</span><span class="p">}},</span> <span class="n">upsert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<h2 id="删除数据">删除数据</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span> <span class="c1"># 删除集合</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec_or_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="lineno">4 </span>
<span class="lineno">5 </span><span class="c1"># remove() 用于删除单个或全部文档，删除后的文档无法恢复。</span>
<span class="lineno">6 </span>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">})[</span><span class="s2">&quot;_id&quot;</span><span class="p">]</span>
<span class="lineno">7 </span>    <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>  <span class="c1"># 根据 id 删除一条记录</span>
<span class="lineno">8 </span>    <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>  <span class="c1"># 删除集合里的所有记录</span>
<span class="lineno">9 </span>    <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">({</span><span class="s2">&quot;yy&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">})</span> <span class="c1"># 删除yy=5的记录</span></code></pre></figure>

<h2 id="查询">查询</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">  1 </span><span class="c1"># 1.1查询</span>
<span class="lineno">  2 </span><span class="c1"># 查询 age 小于 15 的</span>
<span class="lineno">  3 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:{</span><span class="s2">&quot;$lt&quot;</span><span class="p">:</span><span class="mi">15</span><span class="p">}}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">  4 </span>
<span class="lineno">  5 </span>
<span class="lineno">  6 </span><span class="c1"># 1.2查询一条记录</span>
<span class="lineno">  7 </span>
<span class="lineno">  8 </span><span class="c1"># 查询 name 等于 user8 的</span>
<span class="lineno">  9 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user8&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 10 </span>
<span class="lineno"> 11 </span><span class="c1"># 获取查询的一个</span>
<span class="lineno"> 12 </span><span class="n">u2</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user9&quot;</span><span class="p">})</span> <span class="c1"># 查不到时返回 None</span>
<span class="lineno"> 13 </span><span class="k">print</span> <span class="n">u2</span>
<span class="lineno"> 14 </span>
<span class="lineno"> 15 </span>
<span class="lineno"> 16 </span><span class="c1"># 1.2查询特定键 (fields)</span>
<span class="lineno"> 17 </span>
<span class="lineno"> 18 </span><span class="c1"># select name, age from users where age = 21</span>
<span class="lineno"> 19 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">},</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 20 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 21 </span>
<span class="lineno"> 22 </span>
<span class="lineno"> 23 </span><span class="c1"># 1.3排序(SORT)</span>
<span class="lineno"> 24 </span>
<span class="lineno"> 25 </span><span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span>  <span class="c1"># 也可以用 1 来代替</span>
<span class="lineno"> 26 </span><span class="n">pymongo</span><span class="o">.</span><span class="n">DESCENDING</span> <span class="c1"># 也可以用 -1 来代替</span>
<span class="lineno"> 27 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">)]):</span> <span class="k">print</span> <span class="n">u</span>   <span class="c1"># select * from 集合名 order by 键1</span>
<span class="lineno"> 28 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">DESCENDING</span><span class="p">)]):</span> <span class="k">print</span> <span class="n">u</span>  <span class="c1"># select * from 集合名 order by 键1 desc</span>
<span class="lineno"> 29 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">([(</span><span class="s2">&quot;键1&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;键2&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">DESCENDING</span><span class="p">)]):</span> <span class="k">print</span> <span class="n">u</span> <span class="c1"># select * from 集合名 order by 键1 asc, 键2 desc</span>
<span class="lineno"> 30 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">sort</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;键1&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">ASCENDING</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;键2&quot;</span><span class="p">,</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">DESCENDING</span><span class="p">)]):</span> <span class="k">print</span> <span class="n">u</span> <span class="c1"># sort 的另一种写法</span>
<span class="lineno"> 31 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user9&quot;</span><span class="p">},</span> <span class="n">sort</span><span class="o">=</span><span class="p">[[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s2">&quot;sex&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">]],</span> <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">]):</span> <span class="k">print</span> <span class="n">u</span>  <span class="c1"># 组合写法</span>
<span class="lineno"> 32 </span>
<span class="lineno"> 33 </span>
<span class="lineno"> 34 </span><span class="c1"># 1.4从第几行开始读取(SLICE)，读取多少行(LIMIT)</span>
<span class="lineno"> 35 </span>
<span class="lineno"> 36 </span><span class="c1"># select * from 集合名 skip 2 limit 3</span>
<span class="lineno"> 37 </span><span class="c1"># MySQL 的写法： select * from 集合名 limit 2, 3</span>
<span class="lineno"> 38 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 39 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">skip</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 40 </span>
<span class="lineno"> 41 </span><span class="c1"># 可以用切片代替 skip &amp; limit (mongo 中的 $slice 貌似有点问题)。</span>
<span class="lineno"> 42 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]:</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 43 </span>
<span class="lineno"> 44 </span><span class="c1"># 单独的写</span>
<span class="lineno"> 45 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 46 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 47 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 48 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 49 </span>
<span class="lineno"> 50 </span>
<span class="lineno"> 51 </span><span class="c1"># 1.5多条件查询(Conditional Operators)    # like 的可使用正则表达式查询</span>
<span class="lineno"> 52 </span><span class="c1"># select * from users where name = &quot;user3&quot; and age &gt; 12 and age &lt; 15</span>
<span class="lineno"> 53 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;$lt&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">},</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;user3&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 54 </span><span class="c1"># select * from users where name = &quot;user1&quot; and age = 21</span>
<span class="lineno"> 55 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 56 </span>
<span class="lineno"> 57 </span>
<span class="lineno"> 58 </span><span class="c1"># 1.6 IN</span>
<span class="lineno"> 59 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:{</span><span class="s2">&quot;$in&quot;</span><span class="p">:(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">32</span><span class="p">)}}):</span> <span class="k">print</span> <span class="n">u</span>   <span class="c1"># select * from users where age in (23, 26, 32)</span>
<span class="lineno"> 60 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:{</span><span class="s2">&quot;$nin&quot;</span><span class="p">:(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">32</span><span class="p">)}}):</span> <span class="k">print</span> <span class="n">u</span>  <span class="c1"># select * from users where age not in (23, 26, 32)</span>
<span class="lineno"> 61 </span>
<span class="lineno"> 62 </span>
<span class="lineno"> 63 </span><span class="c1"># 1.7统计总数(COUNT)</span>
<span class="lineno"> 64 </span><span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>  <span class="c1"># select count(*) from users</span>
<span class="lineno"> 65 </span><span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;age&quot;</span><span class="p">:{</span><span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">}})</span><span class="o">.</span><span class="n">count</span><span class="p">())</span> <span class="c1"># select count(*) from users where age &gt; 30</span>
<span class="lineno"> 66 </span>
<span class="lineno"> 67 </span>
<span class="lineno"> 68 </span><span class="c1"># 1.8 OR</span>
<span class="lineno"> 69 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;$or&quot;</span><span class="p">:[{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">28</span><span class="p">}]}):</span> <span class="k">print</span> <span class="n">u</span>  <span class="c1"># select * from 集合名 where 键1 = 值1 or 键1 = 值2</span>
<span class="lineno"> 70 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;$or&quot;</span><span class="p">:[{</span><span class="s2">&quot;age&quot;</span><span class="p">:{</span><span class="s2">&quot;$lte&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:{</span><span class="s2">&quot;$gte&quot;</span><span class="p">:</span><span class="mi">33</span><span class="p">}}]}):</span> <span class="k">print</span> <span class="n">u</span>  <span class="c1"># select * from 集合名 where 键1 &lt;= 值1 or 键1 &gt;= 值2</span>
<span class="lineno"> 71 </span>
<span class="lineno"> 72 </span>
<span class="lineno"> 73 </span><span class="c1"># 2.是否存在 (exists)</span>
<span class="lineno"> 74 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;sex&quot;</span><span class="p">:{</span><span class="s2">&quot;$exists&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}})</span>  <span class="c1"># select * from 集合名 where exists 键1</span>
<span class="lineno"> 75 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;sex&quot;</span><span class="p">:{</span><span class="s2">&quot;$exists&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">}})</span> <span class="c1"># select * from 集合名 where not exists 键1</span>
<span class="lineno"> 76 </span>
<span class="lineno"> 77 </span>
<span class="lineno"> 78 </span><span class="c1"># 3.正则表达式查询</span>
<span class="lineno"> 79 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$regex&quot;</span> <span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;(?i)user[135]&quot;</span><span class="p">}},</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]):</span> <span class="k">print</span> <span class="n">u</span> <span class="c1"># 查询出 name 为 user1, user3, user5 的</span>
<span class="lineno"> 80 </span>
<span class="lineno"> 81 </span>
<span class="lineno"> 82 </span><span class="c1"># 4.多级路径的元素值匹配</span>
<span class="lineno"> 83 </span>
<span class="lineno"> 84 </span><span class="c1">#Document 采取 JSON-like 这种层级结构，因此我们可以直接用嵌入(Embed)代替传统关系型数据库的关联引用(Reference)。</span>
<span class="lineno"> 85 </span><span class="c1">#MongoDB 支持以 &quot;.&quot; 分割的 namespace 路径，条件表达式中的多级路径须用引号</span>
<span class="lineno"> 86 </span>
<span class="lineno"> 87 </span><span class="c1"># 如果键里面包含数组，只需简单匹配数组属性是否包含该元素即可查询出来</span>
<span class="lineno"> 88 </span><span class="n">db</span><span class="o">.</span><span class="err">集合名</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="s2">&quot;address1&quot;</span><span class="p">})</span> <span class="c1"># address 是个数组，匹配时仅需包含有即可</span>
<span class="lineno"> 89 </span><span class="c1"># 查询结果如：{&quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;name&quot; : &quot;user1&quot;, &quot;address&quot; : [&quot;address1&quot;, &quot;address2&quot;]}</span>
<span class="lineno"> 90 </span>
<span class="lineno"> 91 </span><span class="c1"># 条件表达式中的多级路径须用引号,以 &quot;.&quot; 分割</span>
<span class="lineno"> 92 </span><span class="n">u</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="err">集合名</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;im.qq&quot;</span><span class="p">:</span><span class="mi">12345678</span><span class="p">})</span>
<span class="lineno"> 93 </span><span class="c1"># 查询结果如：{&quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;name&quot; : &quot;user1&quot;, &quot;im&quot; : {&quot;msn&quot; : &quot;user1@hotmail.com&quot;, &quot;qq&quot; : 12345678}}</span>
<span class="lineno"> 94 </span>
<span class="lineno"> 95 </span><span class="k">print</span> <span class="n">u</span><span class="p">[</span><span class="s2">&quot;im&quot;</span><span class="p">][</span><span class="s2">&quot;msn&quot;</span><span class="p">]</span>  <span class="c1">#显示： user1@hotmail.com</span>
<span class="lineno"> 96 </span>
<span class="lineno"> 97 </span><span class="c1"># 多级路径的更新</span>
<span class="lineno"> 98 </span><span class="n">db</span><span class="o">.</span><span class="err">集合名</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;im.qq&quot;</span><span class="p">:</span><span class="mi">12345678</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:{</span><span class="s2">&quot;im.qq&quot;</span><span class="p">:</span><span class="mi">12345</span><span class="p">}})</span>
<span class="lineno"> 99 </span>
<span class="lineno">100 </span>
<span class="lineno">101 </span><span class="c1"># 5.查询包含特定键的</span>
<span class="lineno">102 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;im.qq&quot;</span><span class="p">:{</span><span class="s2">&quot;$exists&quot;</span><span class="p">:</span><span class="bp">True</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;im.qq&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">103 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;im&quot; : { &quot;qq&quot; : 12345 } }</span>
<span class="lineno">104 </span>
<span class="lineno">105 </span>
<span class="lineno">106 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;abc&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">107 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c47a481b48cde79c6780df5&quot;), &quot;name&quot; : &quot;user8&quot;, &quot;data&quot; : [ { &quot;a&quot; : 1, &quot;b&quot; : 10 }, 3, &quot;abc&quot; ] }</span>
<span class="lineno">108 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;$elemMatch&quot;</span><span class="p">:{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:{</span><span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}}}}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">109 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c47a481b48cde79c6780df5&quot;), &quot;name&quot; : &quot;user8&quot;, &quot;data&quot; : [ { &quot;a&quot; : 1, &quot;b&quot; : 10 }, 3, &quot;abc&quot; ] }</span>
<span class="lineno">110 </span><span class="c1">#{data:&quot;abc&quot;} 仅简单匹配数组属性是否包含该元素。$elemMatch 则可以处理更复杂的元素查找条件。当然也可以写成如下方式：</span>
<span class="lineno">111 </span><span class="n">db</span><span class="o">.</span><span class="err">集合名</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;data.a&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;data.b&quot;</span><span class="p">:{</span><span class="s2">&quot;$gt&quot;</span><span class="p">:</span><span class="mi">5</span><span class="p">}})</span>
<span class="lineno">112 </span>
<span class="lineno">113 </span>
<span class="lineno">114 </span><span class="c1"># 6.对数组, 还可以直接使用序号进行操作：</span>
<span class="lineno">115 </span><span class="n">db</span><span class="o">.</span><span class="err">集合名</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;data.1&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span> <span class="c1"># 序号从0开始</span>
<span class="lineno">116 </span>
<span class="lineno">117 </span>
<span class="lineno">118 </span><span class="c1"># 7.如集合的一列内容</span>
<span class="lineno">119 </span>
<span class="lineno">120 </span><span class="p">{</span><span class="s2">&quot;classifyid&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span>
<span class="lineno">121 </span>      <span class="s2">&quot;keyword&quot;</span><span class="p">:[</span>
<span class="lineno">122 </span>            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span> <span class="c1"># 将修改此值为 test5 (数组下标从0开始,下标也是用点)</span>
<span class="lineno">123 </span>            <span class="s2">&quot;frequence&quot;</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span>
<span class="lineno">124 </span>            <span class="p">},</span>
<span class="lineno">125 </span>            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;test2&quot;</span><span class="p">,</span> <span class="c1"># 子表的查询，会匹配到此值</span>
<span class="lineno">126 </span>            <span class="s2">&quot;frequence&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
<span class="lineno">127 </span>            <span class="p">},</span>
<span class="lineno">128 </span>      <span class="p">]</span>
<span class="lineno">129 </span><span class="p">}</span>
<span class="lineno">130 </span>
<span class="lineno">131 </span>
<span class="lineno">132 </span><span class="c1"># 8.子表的修改(子表的其它内容不变)</span>
<span class="lineno">133 </span><span class="n">db</span><span class="o">.</span><span class="err">集合名</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;classifyid&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:{</span><span class="s2">&quot;keyword.0.name&quot;</span><span class="p">:</span><span class="s2">&quot;test5&quot;</span><span class="p">}})</span>
<span class="lineno">134 </span>
<span class="lineno">135 </span>
<span class="lineno">136 </span><span class="c1"># 9.子表的查询</span>
<span class="lineno">137 </span><span class="n">db</span><span class="o">.</span><span class="err">集合名</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;classifyid&quot;</span><span class="p">:</span><span class="s2">&quot;test1&quot;</span><span class="p">,</span> <span class="s2">&quot;keyword.0.name&quot;</span><span class="p">:</span><span class="s2">&quot;test2&quot;</span><span class="p">})</span></code></pre></figure>

<h2 id="操作">操作</h2>

<h3 id="all-判断数组属性是否包含全部条件">$all: 判断数组属性是否包含全部条件。</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user3&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]})</span>
<span class="lineno">2 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user4&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]})</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;$all&quot;</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">5 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c47a133b48cde79c6780df0&quot;), &quot;name&quot; : &quot;user3&quot;, &quot;data&quot; : [ 1, 2, 3, 4, 5, 6, 7 ] }</span></code></pre></figure>

<p>注意和 $in 的区别。$in 是检查目标属性值是条件表达式中的一员，而 $all 则要求属性值包含全部条件元素。</p>

<h3 id="size-匹配数组属性元素数量">$size: 匹配数组属性元素数量。</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;$size&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">}}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">2 </span><span class="c1"># 只显示匹配此数组数量的： { &quot;_id&quot; : ObjectId(&quot;4c47a13bb48cde79c6780df1&quot;), &quot;name&quot; : &quot;user4&quot;, &quot;data&quot; : [ 1, 2, 3 ] }</span></code></pre></figure>

<h3 id="type-判断属性类型">$type: 判断属性类型。</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;t&quot;</span><span class="p">:{</span><span class="s2">&quot;$type&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}}):</span> <span class="k">print</span> <span class="n">u</span>  <span class="c1"># 查询数字类型的</span>
<span class="lineno">2 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;t&quot;</span><span class="p">:{</span><span class="s2">&quot;$type&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}}):</span> <span class="k">print</span> <span class="n">u</span>  <span class="c1"># 查询字符串类型的</span></code></pre></figure>

<p>类型值:
    double:1
    string: 2
    object: 3
    array: 4
    binary data: 5
    object id: 7
    boolean: 8
    date: 9
    null: 10
    regular expression: 11
    javascript code: 13
    symbol: 14
    javascript code with scope: 15
    32-bit integer: 16
    timestamp: 17
    64-bit integer: 18
    min key: 255
    max key: 127</p>

<h3 id="not-取反表示返回条件不成立的文档">$not: 取反，表示返回条件不成立的文档。</h3>
<p>似乎只能跟正则和 $mod 一起使用？？？？</p>

<h3 id="unset-和-set-相反表示移除文档属性">$unset: 和 $set 相反，表示移除文档属性。</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno">1 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">2 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;name&quot; : &quot;user1&quot;, &quot;age&quot; : 15, &quot;address&quot; : [ &quot;address1&quot;, &quot;address2&quot; ] }</span>
<span class="lineno">3 </span>
<span class="lineno">4 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$unset&quot;</span><span class="p">:{</span><span class="s2">&quot;address&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno">5 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">6 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;name&quot; : &quot;user1&quot; }</span></code></pre></figure>

<h3 id="push和pushall都是向数组属性添加元素-好像两者没啥区别">$push和$pushAll:都是向数组属性添加元素。# 好像两者没啥区别</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 2 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;age&quot; : 15, &quot;name&quot; : &quot;user1&quot; }</span>
<span class="lineno"> 3 </span>
<span class="lineno"> 4 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$push&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 5 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 6 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;age&quot; : 15, &quot;data&quot; : [ 1 ], &quot;name&quot; : &quot;user1&quot; }</span>
<span class="lineno"> 7 </span>
<span class="lineno"> 8 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$pushAll&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]}})</span>
<span class="lineno"> 9 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user1&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">10 </span><span class="c1"># 显示如： { &quot;_id&quot; : ObjectId(&quot;4c479885089df9b53474170a&quot;), &quot;age&quot; : 15, &quot;data&quot; : [ 1, 2, 3, 4, 5 ], &quot;name&quot; : &quot;user1&quot; }</span></code></pre></figure>

<h3 id="addtoset和push类似不过仅在该元素不存在时才添加-set-表示不重复元素集合">$addToSet和$push类似，不过仅在该元素不存在时才添加 (Set 表示不重复元素集合)。</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$unset&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 2 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 3 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 4 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 5 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c479896089df9b53474170b&quot;), &quot;data&quot; : [ 1 ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno"> 6 </span>
<span class="lineno"> 7 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$push&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 8 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 9 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c479896089df9b53474170b&quot;), &quot;data&quot; : [ 1, 1 ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno">10 </span>
<span class="lineno">11 </span><span class="err">要添加多个元素，使用</span> <span class="err">$</span><span class="n">each</span><span class="err">。</span>
<span class="lineno">12 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;$each&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}}})</span>
<span class="lineno">13 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">14 </span><span class="c1"># 显示： {u&quot;age&quot;: 12, u&quot;_id&quot;: ObjectId(&quot;4c479896089df9b53474170b&quot;), u&quot;data&quot;: [1, 1, 2, 3, 4], u&quot;name&quot;: u&quot;user2&quot;}</span>
<span class="lineno">15 </span><span class="c1"># 貌似不会自动删除重复</span></code></pre></figure>

<h3 id="each-添加多个元素用">$each 添加多个元素用。</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$unset&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 2 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 3 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 4 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c479896089df9b53474170b&quot;), &quot;data&quot; : [ 1 ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;$each&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}}})</span>
<span class="lineno"> 7 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 8 </span><span class="c1"># 显示： {u&quot;age&quot;: 12, u&quot;_id&quot;: ObjectId(&quot;4c479896089df9b53474170b&quot;), u&quot;data&quot;: [1, 2, 3, 4], u&quot;name&quot;: u&quot;user2&quot;}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}})</span>
<span class="lineno">11 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">12 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c479896089df9b53474170b&quot;), &quot;data&quot; : [ 1, 2, 3, 4, [ 1, 2, 3, 4 ] ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$unset&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno">15 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}})</span>
<span class="lineno">16 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">17 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c47a133b48cde79c6780df0&quot;), &quot;data&quot; : [ [1, 2, 3, 4] ], &quot;name&quot; : &quot;user2&quot; }</span></code></pre></figure>

<h3 id="pop-移除数组属性的元素按数组下标移除pull-按值移除pullall-移除所有符合提交的元素">$pop: 移除数组属性的元素(按数组下标移除)，$pull 按值移除，$pullAll 移除所有符合提交的元素。</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$unset&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="lineno"> 2 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$addToSet&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:{</span><span class="s2">&quot;$each&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">]}}})</span>
<span class="lineno"> 3 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 4 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c47a133b48cde79c6780df0&quot;), &quot;data&quot; : [ 1, 2, 3, 4, 5, 6, 7, 2, 3 ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$pop&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span> <span class="c1"># 移除最后一个元素</span>
<span class="lineno"> 7 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 8 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c47a133b48cde79c6780df0&quot;), &quot;data&quot; : [ 1, 2, 3, 4, 5, 6, 7, 2 ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$pop&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">}})</span> <span class="c1"># 移除第一个元素</span>
<span class="lineno">11 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">12 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c47a133b48cde79c6780df0&quot;), &quot;data&quot; : [ 2, 3, 4, 5, 6, 7, 2 ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno">13 </span>
<span class="lineno">14 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$pull&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}})</span> <span class="c1"># 移除全部 2</span>
<span class="lineno">15 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">16 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c47a133b48cde79c6780df0&quot;), &quot;data&quot; : [ 3, 4, 5, 6, 7 ], &quot;name&quot; : &quot;user2&quot; }</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;$pullAll&quot;</span><span class="p">:{</span><span class="s2">&quot;data&quot;</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]}})</span> <span class="c1"># 移除 3,5,6</span>
<span class="lineno">19 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user2&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">20 </span><span class="c1"># 显示： { &quot;_id&quot; : ObjectId(&quot;4c47a133b48cde79c6780df0&quot;), &quot;data&quot; : [ 4, 7 ], &quot;name&quot; : &quot;user2&quot; }</span></code></pre></figure>

<h3 id="where-用-js-代码来代替有些丑陋的-ltgt">$where: 用 JS 代码来代替有些丑陋的 $lt、$gt。</h3>

<p>MongoDB 内置了 Javascript Engine (SpiderMonkey)。可直接使用 JS Expression，甚至使用 JS Function 写更复杂的 Code Block。</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="lineno"> 1 </span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span> <span class="c1"># 删除集合里的所有记录</span>
<span class="lineno"> 2 </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="lineno"> 3 </span>    <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;user&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="n">i</span><span class="p">})</span>
<span class="lineno"> 4 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">():</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno"> 5 </span><span class="c1"># 显示如下：</span>
<span class="lineno"> 6 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226e&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user0&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">}</span>
<span class="lineno"> 7 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226f&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user1&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="lineno"> 8 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2270&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user2&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
<span class="lineno"> 9 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2271&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user3&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">3</span> <span class="p">}</span>
<span class="lineno">10 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2272&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user4&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">4</span> <span class="p">}</span>
<span class="lineno">11 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2273&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user5&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="lineno">12 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2274&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user6&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">6</span> <span class="p">}</span>
<span class="lineno">13 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2275&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user7&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">7</span> <span class="p">}</span>
<span class="lineno">14 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2276&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user8&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">8</span> <span class="p">}</span>
<span class="lineno">15 </span><span class="p">{</span> <span class="s2">&quot;_id&quot;</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2277&quot;</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span> <span class="p">:</span> <span class="s2">&quot;user9&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="mi">9</span> <span class="p">}</span>
<span class="lineno">16 </span>
<span class="lineno">17 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;$where&quot;</span><span class="p">:</span><span class="s2">&quot;this.age &gt; 7 || this.age &lt; 3&quot;</span><span class="p">}):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">18 </span><span class="c1"># 显示如下：</span>
<span class="lineno">19 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226e&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user0&quot;</span><span class="p">}</span>
<span class="lineno">20 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226f&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user1&quot;</span><span class="p">}</span>
<span class="lineno">21 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2270&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user2&quot;</span><span class="p">}</span>
<span class="lineno">22 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">8.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2276&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user8&quot;</span><span class="p">}</span>
<span class="lineno">23 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2277&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user9&quot;</span><span class="p">}</span>
<span class="lineno">24 </span>
<span class="lineno">25 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;this.age &gt; 7 || this.age &lt; 3&quot;</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">26 </span><span class="c1"># 显示如下：</span>
<span class="lineno">27 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226e&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user0&quot;</span><span class="p">}</span>
<span class="lineno">28 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226f&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user1&quot;</span><span class="p">}</span>
<span class="lineno">29 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2270&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user2&quot;</span><span class="p">}</span>
<span class="lineno">30 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">8.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2276&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user8&quot;</span><span class="p">}</span>
<span class="lineno">31 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2277&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user9&quot;</span><span class="p">}</span>
<span class="lineno">32 </span>
<span class="lineno">33 </span><span class="c1"># 使用自定义的 function, javascript语法的</span>
<span class="lineno">34 </span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;function() { return this.age &gt; 7 || this.age &lt; 3;}&quot;</span><span class="p">):</span> <span class="k">print</span> <span class="n">u</span>
<span class="lineno">35 </span><span class="c1"># 显示如下：</span>
<span class="lineno">36 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226e&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user0&quot;</span><span class="p">}</span>
<span class="lineno">37 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da226f&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user1&quot;</span><span class="p">}</span>
<span class="lineno">38 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2270&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user2&quot;</span><span class="p">}</span>
<span class="lineno">39 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">8.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2276&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user8&quot;</span><span class="p">}</span>
<span class="lineno">40 </span><span class="p">{</span><span class="sa">u</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s2">&quot;4c47b3372a9b2be866da2277&quot;</span><span class="p">),</span> <span class="sa">u</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;user9&quot;</span><span class="p">}</span></code></pre></figure>

        <div id="disqus_thread"></div>
		<script type="text/javascript">
		    /* * * CONFIGURATION VARIABLES * * */
		    var disqus_shortname = 'albus12138';
		    
		    /* * * DON'T EDIT BELOW THIS LINE * * */
		    (function() {
		        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		    })();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>

    <div class="sidenav">
        <h2>Blog</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/blog/why-blog">我为什么写博客？</a></li>
            
            
        
        </ul>

        <h2>Coding</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/coding/python-re">Python正则表达式</a></li>
            
            
        
            
            <li><a href="/coding/xctf-carnival-wp">XCTF嘉年华体验赛 Re部分WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/gctf-wp">GCTF Re&Mobile WriteUp</a></li>
            
            
        
            
            <li><a href="/coding/python-requests">Requests模块</a></li>
            
            
        
            
            <li><a href="/coding/iscc-2017-wp">ISCC2017 WriteUp</a></li>
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
            
            
        
        </ul>

        <h2>Bookmarks</h2>
        <ul class="artical-list">
        
        
            
            <li><a href="/bookmarks/ddos">免费DDOS攻击测试工具</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking-2">网络流量攻击的危害</a></li>
            
            
        
            
            <li><a href="/bookmarks/network-traffic-hijacking">网络流量攻击</a></li>
            
            
        
            
            <li><a href="/bookmarks/resouces-for-learn-python">学习Python编程的11个资源</a></li>
            
            
        
            
            <li><a href="/bookmarks/buffer-overflow">缓冲区溢出攻击相关知识</a></li>
            
            
        
        </ul>
    </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>

    <script type="text/javascript">
        $(function(){
            $('.home-follow').click(function(e){
                e.preventDefault();
            });
        })
        $(document).ready(function(){
            var id = Math.floor(Math.random()*5)+1;
            $(".aside").css("background-image","url(/images/bg-"+id+".jpg)");            
        })
    </script>
</body>
</html>
